import{p as dt,A as u,i as m,j as Ne,x as W,ac as ut,f as F,a as ae,b,c as ct,h as a,g as e,C as k,I as ft,k as _,s as w,e as z,l as H,ad as Ve,ae as vt,F as pt,t as le,u as yt,m as ve}from"./iframe-D7RYvwF5.js";import{k as bt,u as Se}from"./ucfirst-D2sS6U5O.js";import{s as x}from"./attributes-AHszVgQG.js";import{s as Ee}from"./class-CSG4cUfb.js";import{a as mt}from"./input-CeMRp2yv.js";import{b as Me}from"./this-p55_KPOp.js";import{c as gt}from"./form-Dq9J9N2L.js";import{F as kt}from"./form-field-De-aDgvW.js";import{u as xt}from"./unique-id-JjuMjhtj.js";import{M as ht}from"./menu-Dbx_mKWU.js";import{I as Pe}from"./icon-v8TPefiR.js";import{P as _t}from"./prompt-BhA4zG_Z.js";const wt=(ne,s=300)=>{let v;return()=>{clearTimeout(v),v=setTimeout(()=>ne(),s)}};var Ct=F('<div class="loading-indicator svelte-pbvxd8" aria-hidden="true"><div class="spinner svelte-pbvxd8"></div></div>'),It=F('<button type="button" class="clear svelte-pbvxd8" aria-label="Clear selection" tabindex="-1">X</button>'),Ft=F('<div class="no-results svelte-pbvxd8" role="status">No results found</div>'),Tt=F('<button type="button" role="option"><!> <span class="svelte-pbvxd8"><!></span></button>'),Dt=F('<div class="sr-only svelte-pbvxd8" role="status" aria-live="polite" aria-atomic="true"><!></div> <div><input type="text" role="combobox" aria-haspopup="listbox" class="svelte-pbvxd8"/> <button type="button" class="icon svelte-pbvxd8" tabindex="-1"><!></button> <!> <!> <div class="dropdown svelte-pbvxd8"><!> <!> <!></div></div>',1),Nt=F('<div class="create-error svelte-pbvxd8" role="alert"> </div>'),Vt=F('<div class="creating-indicator svelte-pbvxd8" aria-live="polite">Creating...</div>'),St=F("<!> <!>",1),Et=F("<!> <!>",1);function Mt(ne,s){dt(s,!0);let v=u(s,"value",15,null),pe=u(s,"items",19,()=>[]),ye=u(s,"fieldNames",3,void 0),qe=u(s,"size",3,"md"),h=u(s,"disabled",3,!1),be=u(s,"required",3,!1),T=u(s,"readonly",3,!1),ze=u(s,"searchable",3,!1),R=u(s,"search",3,void 0),Le=u(s,"placeholder",3,""),ie=u(s,"onChange",3,void 0),Ae=u(s,"onFocus",3,void 0),Be=u(s,"onBlur",3,void 0),Oe=u(s,"label",3,void 0),He=u(s,"helperText",3,void 0),Re=u(s,"feedback",3,void 0),Ue=u(s,"virtualScroll",3,!1),je=u(s,"itemHeight",3,40),S=u(s,"createNew",3,void 0),L=u(s,"resourceName",3,void 0);const re=xt(),U=`${re}-listbox`,Ke=k(()=>gt(ye())),me=k(()=>ye()?pe().map(t=>e(Ke).toReferenceItem(t)):pe());let j=m(Ne([])),Y=k(()=>R()?e(j):e(me));const ge=()=>{var t;return((t=e(Y).find(l=>l.value==v()))==null?void 0:t.label)||""};let p=m(""),c=m(!1),i=m(-1),y=k(()=>ze()||!!R()),g=m(null),Z=m(null),A=m(!1),E=m(!1),K=m(!1),se=m(!1),D=m(null),ke=m(0);W(()=>{R()||a(j,[...e(me)],!0)});let oe=m(Ne(v()!=null?String(v()):null));W(()=>{a(oe,v()!=null?String(v()):null,!0)}),W(()=>{var P;const t=v(),l=e(Y),f=e(A);if(e(y)&&f)return;const C=((P=l.find(B=>B.value==t))==null?void 0:P.label)||"";ft(()=>e(p))!==C&&a(p,C,!0)});let r=k(()=>{const t=e(p).trim().toLowerCase();return t&&e(y)?e(Y).map((l,f)=>({...l,index:f})).filter(l=>l.label.toLowerCase().includes(t)):e(Y).map((l,f)=>({...l,index:f}))}),xe=k(()=>e(y)&&e(p).trim()&&e(r).length===0&&!e(E)),Xe=k(()=>e(i)>=0&&e(r)[e(i)]?`${U}-option-${e(i)}`:void 0);W(()=>{const t=e(r).length-1;e(i)>t&&a(i,t)});let M=k(()=>e(c)&&!h()&&!T()),Ge=k(()=>!!S()&&e(M));const X=t=>{var l;a(A,!1),v(t.value),(l=ie())==null||l(v()),a(p,ge(),!0),a(c,!1),a(i,-1),e(g)&&e(g).blur()},G=()=>{!h()&&!T()&&(a(c,!0),e(g)&&e(g).focus())},de=()=>{a(c,!1),a(i,-1),a(A,!1),a(p,ge(),!0)},Je=t=>{var l;(l=Ae())==null||l(t),e(g)&&e(g).select()},Qe=t=>{var l;(l=Be())==null||l(t)},We=()=>{e(c)?de():G()},he=t=>{t.preventDefault(),t.stopPropagation(),!h()&&We()},Ye=t=>{h()||T()||!e(y)&&!e(c)&&(t.preventDefault(),G())},Ze=t=>{if(!(h()||T())){if(t.key==="Escape"){t.preventDefault(),de(),e(g)&&e(g).blur();return}if(t.key==="Enter"){t.preventDefault(),e(c)&&e(i)>=0&&e(i)<e(r).length&&e(r)[e(i)]?X(e(r)[e(i)]):e(c)&&S()&&e(i)===e(r).length?ue():e(c)&&e(y)&&e(r).length>0?X(e(r)[0]):e(c)||G();return}if(t.key==="Tab"){e(c)&&e(i)>=0&&e(i)<e(r).length&&e(r)[e(i)]?(t.preventDefault(),X(e(r)[e(i)])):e(c)&&S()&&e(i)===e(r).length?(t.preventDefault(),ue()):e(c)&&e(y)&&e(r).length>0&&(t.preventDefault(),X(e(r)[0]));return}if(t.key==="ArrowDown"){t.preventDefault(),e(c)||G();const l=S()?e(r).length:e(r).length-1;l>=0&&a(i,Math.min(e(i)+1,l),!0);return}if(t.key==="ArrowUp"){t.preventDefault(),e(c)&&(S()?e(r).length:e(r).length-1)>=0&&a(i,Math.max(e(i)-1,0),!0);return}e(y)&&(t.key.length===1||t.key==="Backspace"||t.key==="Delete")&&(a(A,!0),e(c)||G(),a(i,0),setTimeout(()=>_e(),0))}},_e=wt(async()=>{if(R()&&e(y)){a(E,!0);try{a(j,await R()(e(p)),!0)}finally{a(E,!1)}}},300),we=t=>{var l;t.preventDefault(),t.stopPropagation(),!(h()||T())&&(a(A,!1),a(p,""),v(null),(l=ie())==null||l(null),e(g)&&e(g).focus())},$e=async t=>{var l;if(S()){a(se,!0),a(D,null);try{const f=await S()(t);f?(a(j,[...e(j),f],!0),v(f.value),(l=ie())==null||l(v()),a(p,f.label,!0),a(c,!1),a(K,!1)):a(D,"Failed to create new item")}catch(f){a(D,f instanceof Error?f.message:"An error occurred",!0)}finally{a(se,!1)}}},ue=()=>{a(D,null),vt(ke),a(K,!0),a(c,!1)};W(()=>{e(K)||a(D,null)}),ut(()=>{const t=l=>{e(Z)&&!e(Z).contains(l.target)&&de()};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}});var Ce=Et(),Ie=ae(Ce);kt(Ie,{get size(){return qe()},get label(){return Oe()},get id(){return re},get required(){return be()},get disabled(){return h()},get helperText(){return He()},get feedback(){return Re()},children:(t,l)=>{var f=Dt(),C=ae(f),ce=z(C);{var P=n=>{var d=le("Searching...");b(n,d)},B=n=>{var d=yt(),V=ae(d);{var $=Q=>{var ee=le();H(()=>ve(ee,`${e(r).length??""} ${e(r).length===1?"result":"results"} found`)),b(Q,ee)};_(V,Q=>{e(y)&&e(p)&&Q($)},!0)}b(n,d)};_(ce,n=>{e(y)&&e(p)&&e(E)?n(P):n(B,!1)})}var J=w(C,2),o=z(J);o.__keydown=Ze,o.__click=Ye,o.__input=()=>{e(y)&&(a(A,!0),_e())},Me(o,n=>a(g,n),()=>e(g));var N=w(o,2);N.__click=he,N.__keydown=he;var I=z(N);Pe(I,{type:"angle-up",size:"sm"});var q=w(N,2);{var fe=n=>{var d=Ct();b(n,d)};_(q,n=>{e(E)&&n(fe)})}var Fe=w(q,2);{var tt=n=>{var d=It();d.__click=we,d.__keydown=we,H(()=>d.disabled=h()||T()),b(n,d)};_(Fe,n=>{v()&&e(y)&&!e(E)&&n(tt)})}var at=w(Fe,2),Te=z(at);{var lt=n=>{var d=Ft();b(n,d)};_(Te,n=>{e(xe)&&e(M)&&n(lt)})}var De=w(Te,2);{var nt=n=>{{let d=k(()=>e(y)?e(p):"");ht(n,{get items(){return e(r)},get open(){return e(M)},closeAfterSelect:!0,get searchText(){return e(d)},onSelect:X,get listboxId(){return U},get virtualScroll(){return Ue()},get itemHeight(){return je()},size:"full",get highlightIndex(){return e(i)},set highlightIndex(V){a(i,V,!0)},get value(){return e(oe)},set value(V){a(oe,V,!0)}})}};_(De,n=>{(!e(xe)||!e(M))&&n(nt)})}var it=w(De,2);{var rt=n=>{var d=Tt();let V;d.__click=ue;var $=z(d);Pe($,{type:"plus",size:"sm"});var Q=w($,2),ee=z(Q);{var st=O=>{var te=le();H(()=>ve(te,`Create new ${L()??""}...`)),b(O,te)},ot=O=>{var te=le("Create new...");b(O,te)};_(ee,O=>{L()?O(st):O(ot,!1)})}H(()=>{V=Ee(d,1,"create-new svelte-pbvxd8",null,V,{selected:e(i)===e(r).length}),x(d,"id",U?`${U}-option-create`:void 0),x(d,"aria-selected",e(i)===e(r).length)}),b(n,d)};_(it,n=>{e(Ge)&&n(rt)})}Me(J,n=>a(Z,n),()=>e(Z)),H(()=>{Ee(J,1,`listbox-container ${e(M)?"open":"closed"} ${h()?"disabled":"enabled"}`,"svelte-pbvxd8"),x(o,"id",re),o.required=be(),o.disabled=h(),x(o,"placeholder",Le()),o.readOnly=T()||!e(y),x(o,"aria-expanded",e(M)),x(o,"aria-controls",U),x(o,"aria-autocomplete",e(y)?"list":"none"),x(o,"aria-activedescendant",e(Xe)),x(o,"aria-busy",e(E)),x(o,"data-value",v()),x(o,"data-text",e(p)),N.disabled=h()||T(),x(N,"aria-label",e(M)?"Close options":"Open options")}),Ve("focus",o,Je),Ve("blur",o,Qe),mt(o,()=>e(p),n=>a(p,n)),b(t,f)},$$slots:{default:!0}});var et=w(Ie,2);bt(et,()=>e(ke),t=>{{let l=k(()=>L()?`Create New ${Se(L())}`:"Create New"),f=k(()=>L()?`Create ${Se(L())}`:"Create");_t(t,{get title(){return e(l)},placeholder:"Enter name",required:!0,get okText(){return e(f)},cancelText:"Cancel",onOk:$e,onCancel:()=>{a(D,null)},get open(){return e(K)},set open(C){a(K,C,!0)},children:(C,ce)=>{var P=St(),B=ae(P);{var J=I=>{var q=Nt(),fe=z(q);H(()=>ve(fe,e(D))),b(I,q)};_(B,I=>{e(D)&&I(J)})}var o=w(B,2);{var N=I=>{var q=Vt();b(I,q)};_(o,I=>{e(se)&&I(N)})}b(C,P)},$$slots:{default:!0}})}}),b(ne,Ce),ct()}pt(["keydown","click","input"]);Mt.__docgen={data:[{name:"value",visibility:"public",keywords:[],kind:"let",type:{kind:"union",type:[{kind:"type",type:"string",text:"string"},{kind:"type",type:"number",text:"number"}],text:"string | number"},static:!1,readonly:!1,defaultValue:"..."},{name:"items",visibility:"public",keywords:[],kind:"let",type:{kind:"type",type:"array",text:"any[]"},static:!1,readonly:!1,defaultValue:"..."},{name:"fieldNames",visibility:"public",description:`Maps database field names to ReferenceItem properties.
Use this when your data uses different field names (e.g., 'name' instead of 'label').`,keywords:[],kind:"let",type:{kind:"type",type:"object",text:"FieldNameMapping"},static:!1,readonly:!1,defaultValue:"..."},{name:"size",visibility:"public",keywords:[],kind:"let",type:{kind:"union",type:[{kind:"const",type:"string",value:"xs",text:'"xs"'},{kind:"const",type:"string",value:"sm",text:'"sm"'},{kind:"const",type:"string",value:"md",text:'"md"'},{kind:"const",type:"string",value:"lg",text:'"lg"'},{kind:"const",type:"string",value:"xl",text:'"xl"'}],text:'"xs" | "sm" | "md" | "lg" | "xl"'},static:!1,readonly:!1,defaultValue:'"md"'},{name:"disabled",visibility:"public",keywords:[],kind:"let",type:{kind:"type",type:"boolean",text:"boolean"},static:!1,readonly:!1,defaultValue:"false"},{name:"required",visibility:"public",keywords:[],kind:"let",type:{kind:"type",type:"boolean",text:"boolean"},static:!1,readonly:!1,defaultValue:"false"},{name:"readonly",visibility:"public",keywords:[],kind:"let",type:{kind:"type",type:"boolean",text:"boolean"},static:!1,readonly:!1,defaultValue:"false"},{name:"searchable",visibility:"public",keywords:[],kind:"let",type:{kind:"type",type:"boolean",text:"boolean"},static:!1,readonly:!1,defaultValue:"false"},{name:"search",visibility:"public",keywords:[],kind:"let",type:{kind:"function",text:"SearchFunction"},static:!1,readonly:!1},{name:"placeholder",visibility:"public",keywords:[],kind:"let",type:{kind:"type",type:"string",text:"string"},static:!1,readonly:!1,defaultValue:'""'},{name:"onChange",visibility:"public",keywords:[],kind:"let",type:{kind:"function",text:"(value: string | number | null) => void"},static:!1,readonly:!1},{name:"onFocus",visibility:"public",keywords:[],kind:"let",type:{kind:"function",text:"(e: FocusEvent) => void"},static:!1,readonly:!1},{name:"onBlur",visibility:"public",keywords:[],kind:"let",type:{kind:"function",text:"(e: FocusEvent) => void"},static:!1,readonly:!1},{name:"label",visibility:"public",keywords:[],kind:"let",type:{kind:"type",type:"string",text:"string"},static:!1,readonly:!1},{name:"helperText",visibility:"public",keywords:[],kind:"let",type:{kind:"type",type:"string",text:"string"},static:!1,readonly:!1},{name:"feedback",visibility:"public",keywords:[],kind:"let",type:{kind:"type",type:"intersection",text:"FormFieldMessage & { details?: FormFieldMessage[] | undefined; }"},static:!1,readonly:!1},{name:"virtualScroll",visibility:"public",keywords:[],kind:"let",type:{kind:"type",type:"boolean",text:"boolean"},static:!1,readonly:!1,defaultValue:"false"},{name:"itemHeight",visibility:"public",keywords:[],kind:"let",type:{kind:"type",type:"number",text:"number"},static:!1,readonly:!1,defaultValue:"40"},{name:"createNew",visibility:"public",keywords:[],kind:"let",type:{kind:"function",text:"CreateNewFunction<ReferenceItem>"},static:!1,readonly:!1},{name:"resourceName",visibility:"public",keywords:[],kind:"let",type:{kind:"type",type:"string",text:"string"},static:!1,readonly:!1}],name:"list-box.svelte"};export{Mt as L};
